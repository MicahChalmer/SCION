(function(){if(!this.require){var a={},b={},c=function(f,g){var h=d(g,f),i=b[h],j;if(i)return i.exports;if(!(j=a[h]||a[h=d(h,"./index")]))throw"module '"+f+"' not found";i={id:h,exports:{}};try{return b[h]=i,j(i.exports,function(a){return c(a,e(h))},i),i.exports}catch(k){throw delete b[h],k}},d=function(a,b){var c=[],d,e;/^\.\.?(\/|$)/.test(b)?d=[a,b].join("/").split("/"):d=b.split("/");for(var f=0,g=d.length;f<g;f++)e=d[f],e==".."?c.pop():e!="."&&e!=""&&c.push(e);return c.join("/")},e=function(a){return a.split("/").slice(0,-1).join("/")};this.require=function(a){return c(a,"")},this.require.define=function(b){for(var c in b)a[c]=b[c]}}return this.require.define}).call(this)({scion:function(a,b,c){c.exports={annotator:b("./util/annotate-scxml-json"),json2model:b("./scxml/json2model"),scxml:b("./scxml/SCXML")}},"scxml/SCXML":function(exports,require,module){function getTransitionWithHigherSourceChildPriority(a){return function(a){var b=a[0],c=a[1];return b.source.depth<c.source.depth?c:c.source.depth<b.source.depth?b:b.documentOrder<c.documentOrder?b:c}}function SCXMLInterpreter(model,opts){this.model=model,this.opts=opts,this.opts.StateIdSet=this.opts.StateIdSet||ArraySet,this.opts.EventSet=this.opts.EventSet||ArraySet,this.opts.TransitionPairSet=this.opts.TransitionPairSet||ArraySet,this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||getTransitionWithHigherSourceChildPriority(this.opts.model),this.opts.globalEval=this.opts.globalEval||eval,this._configuration=new this.opts.BasicStateSet,this._historyValue={},this._innerEventQueue=[],this._isInFinalState=!1,this._datamodel=Object.create(this.model.datamodel),this._timeoutMap={},this._listeners=[]}function SimpleInterpreter(a,b){this._isStepping=!1,this._send=b.send||this._send,this._cancel=b.cancel||this._cancel,SCXMLInterpreter.call(this,a,b)}function BrowserInterpreter(a,b){b=b||{},setupDefaultOpts(b),b.setTimeout||(b.setTimeout=function(a,b){return window.setTimeout(a,b)}),b.clearTimeout||(b.clearTimeout=function(a){return window.clearTimeout(a)}),SimpleInterpreter.call(this,a,b)}function NodeInterpreter(a,b){b=b||{},setupDefaultOpts(b),b.setTimeout=setTimeout,b.clearTimeout=clearTimeout,SimpleInterpreter.call(this,a,b)}var ArraySet=require("./set/ArraySet"),stateKinds=require("./state-kinds-enum"),setupDefaultOpts=require("./setup-default-opts"),scxmlPrefixTransitionSelector=require("./scxml-dynamic-name-match-transition-selector");SCXMLInterpreter.prototype={start:function(){this.opts.printTrace&&console.log("performing initial big step"),this._configuration.add(this.model.root.initial),this.model.scripts.forEach(function(script){with(this._datamodel)this.opts.globalEval(script)},this);for(var k in this._datamodel){var v=this._datamodel[k];v&&(this._datamodel[k]=eval("("+v+")"))}return this._performBigStep(),this.getConfiguration()},getConfiguration:function(){return this._configuration.iter().map(function(a){return a.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(a){return[a].concat(this.opts.model.getAncestors(a))},this).reduce(function(a,b){return a.concat(b)},[]).map(function(a){return a.id}).reduce(function(a,b){return a.indexOf(b)>-1?a:a.concat(b)},[])},isIn:function(a){return this.getFullConfiguration().indexOf(a)>-1},_performBigStep:function(a){a&&this._innerEventQueue.push(new this.opts.EventSet([a]));var b=!0;while(b){var c=this._innerEventQueue.length?this._innerEventQueue.shift():new this.opts.EventSet,d={},e=this._performSmallStep(c,d);b=!e.isEmpty()}this._isInFinalState=this._configuration.iter().every(function(a){return a.kind===stateKinds.FINAL})},_performSmallStep:function(a,b){this.opts.printTrace&&console.log("selecting transitions with eventSet: ",a);var c=this._selectTransitions(a,b);this.opts.printTrace&&console.log("selected transitions: ",c);if(!c.isEmpty()){this.opts.printTrace&&console.log("sorted transitions: ",c);var d=new this.opts.TransitionSet(c.iter().filter(function(a){return a.targets})),e=this._getStatesExited(d),f=e[0],g=e[1],h=this._getStatesEntered(d),i=h[0],j=h[1];this.opts.printTrace&&console.log("basicStatesExited ",f),this.opts.printTrace&&console.log("basicStatesEntered ",i),this.opts.printTrace&&console.log("statesExited ",g),this.opts.printTrace&&console.log("statesEntered ",j);var k=new this.opts.EventSet;this.opts.printTrace&&console.log("executing state exit actions"),g.forEach(function(c){this.opts.printTrace&&console.log("exiting ",c),this._listeners.forEach(function(a){a.onExit(c.id)}),c.onexit.forEach(function(c){this._evaluateAction(c,a,b,k)},this);var d;c.history&&(c.history.isDeep?d=function(a){return a.kind===stateKinds.BASIC&&c.descendants.indexOf(a)>-1}:d=function(a){return a.parent===c},this._historyValue[c.history.id]=g.filter(d))},this);var l=c.iter().sort(function(a,b){return a.documentOrder-b.documentOrder});this.opts.printTrace&&console.log("executing transitition actions"),l.forEach(function(c){this._listeners.forEach(function(a){a.onTransition(c.source.id,c.targets.map(function(a){return a.id}))}),c.actions.forEach(function(c){this._evaluateAction(c,a,b,k)},this)},this),this.opts.printTrace&&console.log("executing state enter actions"),j.forEach(function(c){this._listeners.forEach(function(a){a.onEntry(c.id)}),c.onentry.forEach(function(c){this._evaluateAction(c,a,b,k)},this)},this),this.opts.printTrace&&console.log("updating configuration "),this.opts.printTrace&&console.log("old configuration ",this._configuration),this._configuration.difference(f),this._configuration.union(i),this.opts.printTrace&&console.log("new configuration ",this._configuration),k.isEmpty()||(this.opts.printTrace&&console.log("adding triggered events to inner queue ",k),this._innerEventQueue.push(k)),this.opts.printTrace&&console.log("updating datamodel for next small step :");for(var m in b)this.opts.printTrace&&console.log("key ",m),m in this._datamodel?this.opts.printTrace&&console.log("old value ",this._datamodel[m]):this.opts.printTrace&&console.log("old value is null"),this.opts.printTrace&&console.log("new value ",b[m]),this._datamodel[m]=b[m]}return c},_evaluateAction:function(a,b,c,d){var e=function(){var d={};return a.content?d=a.content:(a.namelist&&a.namelist.forEach(function(a){d[a]=this._datamodel[a]},this),a.params.forEach(function(a){a.expr?d[a.name]=this._eval(a.expr,c,b):a.location&&(d[a.name]=this._datamodel[a.location])},this)),d}.bind(this);switch(a.type){case"raise":this.opts.printTrace&&console.log("sending event",a.event,"with content",a.contentexpr),d.add({name:a.event});break;case"assign":this._datamodel[a.location]=this._eval(a,c,b);break;case"script":this._eval(a,c,b,!0);break;case"log":console.log(this._eval(a,c,b));break;case"send":this._send&&this._send({target:a.targetexpr?this._eval(a.targetexpr,c,b):a.target,name:a.eventexpr?this._eval(a.eventexpr,c,b):a.event,data:e(),origin:this.opts.origin,type:a.typeexpr?this._eval(a.typeexpr,c,b):a.sendType},{delay:a.delayexpr?this._eval(a.delayexpr,c,b):a.delay,sendId:a.idlocation?this._datamodel[a.idlocation]:a.id});break;case"cancel":this._cancel&&this._cancel(a.sendid);break;default:}},_eval:function(a,b,c,d){var e=this._getScriptingInterface(b,c,d);return a.evaluate.call(this.opts.evaluationContext,e.getData,e.setData,e.In,e.events,this._datamodel)},_getScriptingInterface:function(a,b,c){return{setData:c?function(b,c){return a[b]=c}:function(){},getData:function(a){return this._datamodel[a]}.bind(this),In:function(a){return this.isIn(a)}.bind(this),events:b.iter()}},_getStatesExited:function(a){var b=new this.opts.StateSet,c=new this.opts.BasicStateSet;a.iter().forEach(function(a){var d=a.lca,e=d.descendants;this._configuration.iter().forEach(function(a){e.indexOf(a)>-1&&(c.add(a),b.add(a),this.opts.model.getAncestors(a,d).forEach(function(a){b.add(a)}))},this)},this);var d=b.iter().sort(function(a,b){return b.depth-a.depth});return[c,d]},_getStatesEntered:function(a){var b=new this.opts.StateSet,c=new this.opts.BasicStateSet,d=new this.opts.StateSet,e=[],f=function(a,c){g(c);var e=this.opts.model.getLCA(a,c);this.opts.model.getAncestors(c,e).forEach(function(a){a.kind===stateKinds.COMPOSITE?(b.add(a),d.add(a)):g(a)})}.bind(this),g=function(a){if(d.contains(a))return;a.kind===stateKinds.HISTORY?a.id in this._historyValue?this._historyValue[a.id].forEach(function(b){f(a,b)}):(b.add(a),c.add(a)):(b.add(a),a.kind===stateKinds.PARALLEL?e.push.apply(e,a.children.filter(function(a){return a.kind!==stateKinds.HISTORY})):a.kind===stateKinds.COMPOSITE?e.push(a.initial):(a.kind===stateKinds.INITIAL||a.kind===stateKinds.BASIC||a.kind===stateKinds.FINAL)&&c.add(a)),d.add(a)}.bind(this);a.iter().forEach(function(a){a.targets.forEach(function(b){f(a.source,b)})});var h;while(h=e.pop())g(h);var i=b.iter().sort(function(a,b){return a.depth-b.depth});return[c,i]},_selectTransitions:function(a,b){if(this.opts.onlySelectFromBasicStates)var c=this._configuration.iter();else{var d=new this.opts.StateSet;this._configuration.iter().forEach(function(a){d.add(a),this.opts.model.getAncestors(a).forEach(function(a){d.add(a)})},this),c=d.iter()}var e=this._getScriptingInterface(b,a),f=function(a){return a.evaluateCondition.call(this.opts.evaluationContext,e.getData,e.setData,e.In,e.events,this._datamodel)}.bind(this),g=a.iter().map(function(a){return a.name}),h=g.filter(function(a){return a.search(".")}).length,i=h?scxmlPrefixTransitionSelector:this.opts.transitionSelector,j=new this.opts.TransitionSet;c.forEach(function(a){i(a,g,f).forEach(function(a){j.add(a)})});var k=this._selectPriorityEnabledTransitions(j);return this.opts.printTrace&&console.log("priorityEnabledTransitions",k),k},_selectPriorityEnabledTransitions:function(a){var b=new this.opts.TransitionSet,c=this._getInconsistentTransitions(a),d=c[0],e=c[1];b.union(d),this.opts.printTrace&&console.log("enabledTransitions",a),this.opts.printTrace&&console.log("consistentTransitions",d),this.opts.printTrace&&console.log("inconsistentTransitionsPairs",e),this.opts.printTrace&&console.log("priorityEnabledTransitions",b);while(!e.isEmpty())a=new this.opts.TransitionSet(e.iter().map(function(a){return this.opts.priorityComparisonFn(a)},this)),c=this._getInconsistentTransitions(a),d=c[0],e=c[1],b.union(d),this.opts.printTrace&&console.log("enabledTransitions",a),this.opts.printTrace&&console.log("consistentTransitions",d),this.opts.printTrace&&console.log("inconsistentTransitionsPairs",e),this.opts.printTrace&&console.log("priorityEnabledTransitions",b);return b},_getInconsistentTransitions:function(a){var b=new this.opts.TransitionSet,c=new this.opts.TransitionPairSet,d=a.iter();this.opts.printTrace&&console.log("transitions",d);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++){var g=d[e],h=d[f];this._conflicts(g,h)&&(b.add(g),b.add(h),c.add([g,h]))}var i=a.difference(b);return[i,c]},_conflicts:function(a,b){return!this._isArenaOrthogonal(a,b)},_isArenaOrthogonal:function(a,b){var c=a.targets?a.lca:a.source,d=b.targets?b.lca:b.source,e=this.opts.model.isOrthogonalTo(c,d);return this.opts.printTrace&&(console.log("transition LCAs",c.id,d.id),console.log("transition LCAs are orthogonal?",e)),e},registerListener:function(a){return this._listeners.push(a)},unregisterListener:function(a){return this._listeners.splice(this._listeners.indexOf(a),1)}},SimpleInterpreter.prototype=Object.create(SCXMLInterpreter.prototype),SimpleInterpreter.prototype.gen=function(a){if(a===undefined)throw new Error("gen must be passed an event object.");if(this._isStepping)throw new Error("gen called before previous call to gen could complete. if executed in single-threaded environment, this means it was called recursively, which is illegal, as it would break SCION step semantics.");return this._isStepping=!0,this._performBigStep(a),this._isStepping=!1,this.getConfiguration()},SimpleInterpreter.prototype._send=function(a,b){var c,d,e=this;if(!this.opts.setTimeout)throw new Error("setTimeout function not set");this.opts.printTrace&&console.log("sending event",a.name,"with content",a.data,"after delay",b.delay),c=function(){return e.gen(a)},d=this.opts.setTimeout(c,b.delay);if(b.sendid)return this._timeoutMap[b.sendid]=d},SimpleInterpreter.prototype._cancel=function(a){if(!this.opts.clearTimeout)throw new Error("clearTimeout function not set");if(a in this._timeoutMap)return this.opts.printTrace&&console.log("cancelling ",a," with timeout id ",this._timeoutMap[a]),this.opts.clearTimeout(this._timeoutMap[a])},BrowserInterpreter.prototype=Object.create(SimpleInterpreter.prototype),NodeInterpreter.prototype=Object.create(SimpleInterpreter.prototype),module.exports={SCXMLInterpreter:SCXMLInterpreter,SimpleInterpreter:SimpleInterpreter,BrowserInterpreter:BrowserInterpreter,NodeInterpreter:NodeInterpreter}},"scxml/default-transition-selector":function(a,b,c){c.exports=function(a,b,c){return a.transitions.filter(function(a){return!a.event||b.indexOf(a.event)>-1&&(!a.cond||c(a))})}},"scxml/json2model":function(a,b,c){function d(a){return a?a.slice(-2)==="ms"?parseFloat(a.slice(0,-2)):a.slice(-1)==="s"?parseFloat(a.slice(0,-1))*1e3:parseFloat(a):0}function e(a,b){return new Function("getData","setData","In","_events","datamodel","var _event = _events[0]; with(datamodel){"+(b?"return":"")+" "+a+"}")}c.exports=function(a){function b(a){return c[a]}var c={};return a.states.forEach(function(a){c[a.id]=a}),a.transitions.forEach(function(a){a.evaluateCondition=e(a.cond,!0)}),a.states.forEach(function(f){f.transitions=f.transitions.map(function(b){return a.transitions[b]});var g=f.onentry.concat(f.onexit);f.transitions.forEach(function(a){a.actions.forEach(function(a){g.push(a)}),a.lca&&(a.lca=c[a.lca])}),g.forEach(function(a){switch(a.type){case"script":a.evaluate=e(a.script);break;case"assign":a.evaluate=e(a.expr,!0);break;case"send":["contentexpr","eventexpr","targetexpr","typeexpr","delayexpr"].filter(function(b){return a[b]}).forEach(function(b){a[b]={evaluate:e(a[b],!0)}}),a.params.forEach(function(a){a.expr&&(a.expr={evaluate:e(a.expr,!0)})});break;case"log":a.evaluate=e(a.expr,!0);break;default:}a.type==="send"&&a.delay&&(a.delay=d(a.delay))}),f.initial=c[f.initial],f.history=c[f.history],f.children=f.children.map(b),f.parent=c[f.parent],f.ancestors&&(f.ancestors=f.ancestors.map(b)),f.descendants&&(f.descendants=f.descendants.map(b)),f.transitions.forEach(function(a){a.source=c[a.source],a.targets=a.targets&&a.targets.map(b)})}),a.root=c[a.root],a}},"scxml/model":function(a,b,c){var d=b("./state-kinds-enum");c.exports={getAncestors:function(a,b){var c,d,e;return d=a.ancestors.indexOf(b),d>-1?a.ancestors.slice(0,d):a.ancestors},getAncestorsOrSelf:function(a,b){return[a].concat(this.getAncestors(a,b))},getDescendantsOrSelf:function(a){return[a].concat(a.descendants)},isOrthogonalTo:function(a,b){return!this.isAncestrallyRelatedTo(a,b)&&this.getLCA(a,b).kind===d.PARALLEL},isAncestrallyRelatedTo:function(a,b){return this.getAncestorsOrSelf(b).indexOf(a)>-1||this.getAncestorsOrSelf(a).indexOf(b)>-1},getLCA:function(a,b){var c=this.getAncestors(a).filter(function(a){return a.descendants.indexOf(b)>-1},this);return c[0]}}},"scxml/scxml-dynamic-name-match-transition-selector":function(a,b,c){function e(a){return new RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function f(a){return d[a]?d[a]:d[a]=e(a)}function g(a,b){var c=a.events,d=c.indexOf("*")>-1?function(){return!0}:function(a){return c.filter(function(b){return f(b).test(a)}).length};return b.filter(d).length}var d={};c.exports=function(a,b,c){return a.transitions.filter(function(a){return(!a.events||g(a,b))&&(!a.cond||c(a))})}},"scxml/set/ArraySet":function(a,b,c){c.exports=function(a){a=a||[],this.o=[],a.forEach(function(a){this.add(a)},this)},c.exports.prototype={add:function(a){if(!this.contains(a))return this.o.push(a)},remove:function(a){var b=this.o.indexOf(a);return b===-1?!1:(this.o.splice(b,1),!0)},union:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.add(a)},this),this},difference:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.remove(a)},this),this},contains:function(a){return this.o.indexOf(a)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(a){var b=a.iter(),c=this.o;return c.every(function(a){return b.indexOf(a)>-1})&&b.every(function(a){return c.indexOf(a)>-1})},toString:function(){return"Set("+this.o.toString()+")"}}},"scxml/setup-default-opts":function(a,b,c){var d=b("./scxml-dynamic-name-match-transition-selector"),e=b("./set/ArraySet"),f=b("./model");c.exports=function(a){return a=a||{},a.TransitionSet=a.TransitionSet||e,a.StateSet=a.StateSet||e,a.BasicStateSet=a.BasicStateSet||e,a.transitionSelector=a.transitionSelector||d,a.model=a.model||f,a}},"scxml/state-kinds-enum":function(a,b,c){c.exports={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5}},"util/annotate-scxml-json":function(a,b,c){function p(a){var b=[];return a.forEach(function(a){var c=r(a),d=c[0],e=c[1],f=c[2];d==="script"&&b.push.apply(b,f.filter(function(a){return typeof a=="string"}))}),b}function q(a){var b,c,d;c=0,d={};for(b in a)d[b]={name:b,documentOrder:c++};return d}function r(a,b){var c,d,e,f,g;return g=a[0],f=a[1],f&&typeof f=="object"&&!Array.isArray(f)&&typeof f!="string"?(c=f,e=a.slice(2)):(c={},e=a.slice(1)),b&&(e=e.filter(function(a){return typeof a!="string"})),[g,c,e]}function t(a,b){var c=r(a,!0),d=c[0],e=c[1],f=c[2];if(e.event){var g;e.event==="*"?g=[e.event]:g=e.event.trim().split(/\s+/).map(function(a){var b=a.match(s);if(b){var c=b[1];if(!b||!c)throw new Error("Unable to parse event: "+a);return c}}),g.filter(function(a){return a!=="*"}).forEach(function(a){i[a]=!0})}var h={documentOrder:j.length,id:j.length,source:b.id,cond:e.cond,events:g,actions:f.map(function(a){return v(a)}),targets:e&&e.target&&e.target.trim().split(/\s+/)};return j.push(h),h}function u(a){var b=r(a),c=b[0],d=b[1],e=b[2];return{name:d.name,expr:d.expr,location:d.location}}function v(a){var b=r(a),c=b[0],d=b[1],e=b[2];switch(c){case"if":return{type:"if",cond:d.cond,actions:e.map(function(a){return v(a)})};case"elseif":return{type:"elseif",cond:d.cond,actions:e.map(function(a){return v(a)})};case"else":return{type:"else",actions:e.map(function(a){return v(a)})};case"log":return{type:"log",expr:d.expr,label:d.label};case"script":return{type:"script",script:e.join("\n")};case"send":return{type:"send",sendType:d.type,delay:d.delay,id:d.id,event:d.event,target:d.target,idlocation:d.idlocation,namelist:d&&d.namelist&&d.namelist.trim().split(/ +/),params:e.filter(function(a){return a[0]==="param"}).map(function(a){return u(a)}),content:e.filter(function(a){return a[0]==="content"}).map(function(a){return r(a)[2][0]})[0],eventexpr:d.eventexpr,targetexpr:d.targetexpr,typeexpr:d.typeexpr,delayexpr:d.delayexpr};case"cancel":return{type:"cancel",sendid:d.sendid};case"assign":return{type:"assign",location:d.location,expr:d.expr};case"raise":return{type:"raise",event:d.event};case"invoke":throw new Error("Element "+c+" not yet supported");case"finalize":throw new Error("Element "+c+" not yet supported");default:return null}}function w(a,b){var c=r(a,!0),d=c[0],e=c[1],f=c[2];f.filter(function(a){return a[0]==="data"}).forEach(function(a){var b=r(a,!0),c=b[0],d=b[1],e=b[2];d.id&&(m[d.id]=d.expr||null)})}function x(a,b){var c=r(a,!0),i=c[0],j=c[1],l=c[2],m=j&&j.id||A(i),n;switch(i){case"state":l.filter(function(a){return f.indexOf(a[0])>-1}).length?n=d.COMPOSITE:n=d.BASIC;break;case"scxml":n=d.COMPOSITE;break;case"initial":n=d.INITIAL;break;case"parallel":n=d.PARALLEL;break;case"final":n=d.FINAL;break;case"history":n=d.HISTORY;break;default:}var o={id:m,kind:n,descendants:[]};k[m]=o,b.length&&(o.parent=b[b.length-1]),n===d.HISTORY&&(o.isDeep=j.type==="deep"?!0:!1),o.documentOrder=g.length,g.push(o);if(n===d.BASIC||n===d.INITIAL||n===d.HISTORY)o.basicDocumentOrder=h.length,h.push(o);o.depth=b.length,o.ancestors=b.slice(),b.forEach(function(a){k[a].descendants.push(o.id)});var p=[],q=[],s=[],u=[],y=b.concat(o.id),z=!1,B=null,C=function(a){var b=x(a,y);return o.initial=b.id,u.push(b),z=!0};l.filter(function(a){return Array.isArray(a)}).forEach(function(a){var b=r(a,!0),c=b[0],d=b[1],f=b[2];switch(c){case"transition":s.push(t(a,o));break;case"onentry":f.forEach(function(a){q.push(v(a))});break;case"onexit":f.forEach(function(a){p.push(v(a))});break;case"initial":if(!!z)throw new Error("Encountered duplicate initial states in state "+o.id);C(a);break;case"history":var g=x(a,y);o.history=g.id,u.push(g);break;case"datamodel":w(a,y);break;default:if(e.indexOf(c)>-1){var h=x(a,y);B===null&&(B=h),u.push(h)}}});if(!z&&i!=="parallel"){var D=j&&j.initial;function E(a){var b;return b=["initial",["transition",{target:a}]],C(b)}D?E(j.initial):B&&E(B.id)}return o.onexit=p,o.onentry=q,o.transitions=s.map(function(a){return a.documentOrder}),o.children=u.map(function(a){return a.id}),o}function A(a){return z[a]=z[a]||0,""+y+"-"+a+"-"+z[a]++}function B(a,b){var c,d,e,f,g,h,i;e=[],a.ancestors.forEach(function(a){d=k[a],d.descendants.indexOf(b.id)>-1&&e.push(a)});if(!e.length)throw new Error("Could not find LCA for states.");return e[0]}var d=b("../scxml/state-kinds-enum"),e=["state","parallel","history","final","initial"],f=e.concat("scxml"),g,h,i,j,k,l,m,n=a.transformAndSerialize=n=function(a){return JSON.stringify(o(a))},o=a.transform=function(a){g=[],h=[],i={},j=[],k={},l=[],m={};var b=x(a,[]),c=r(a),d=c[0],e=c[1],f=c[2];return g.forEach(function(a){a.ancestors.reverse()}),g.forEach(function(a){a.descendants.reverse()}),j.filter(function(a){return a.targets}).forEach(function(a){var b=k[a.source],c=a.targets.map(function(a){return k[a]});if(!b)throw new Error("source missing");if(!c.length)throw new Error("target missing");a.lca=B(b,c[0])}),{states:g,transitions:j,root:b.id,events:q(i),scripts:p(f),profile:e.profile,version:e.version,datamodel:m}},s=/^((([_a-zA-Z0-9]+)\.)*([_a-zA-Z0-9]+))(\.\*)?$/,y="$generated",z={};if(b.main===c){var C=process.argv[2],D=process.argv[3];function E(a){var c,d,e;return e=JSON.parse(a),d=n(e,!0,!0,!0,!0),D==="-"?process.stdout.write(d):(c=b("fs"),c.writeFileSync(D,d,"utf-8"))}if(!C||C==="-"){process.stdin.resume(),process.stdin.setEncoding("utf-8");var F="";process.stdin.on("data",function(a){return F+=a}),process.stdin.on("end",function(){return E(F)})}else{var G=b("fs"),H=G.readFileSync(C,"utf-8");E(H)}}}});