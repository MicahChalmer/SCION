(function(){if(!this.require){var a={},b={},c=function(f,g){var h=d(g,f),i=b[h],j;if(i)return i.exports;if(!(j=a[h]||a[h=d(h,"./index")]))throw"module '"+f+"' not found";i={id:h,exports:{}};try{return b[h]=i,j(i.exports,function(a){return c(a,e(h))},i),i.exports}catch(k){throw delete b[h],k}},d=function(a,b){var c=[],d,e;/^\.\.?(\/|$)/.test(b)?d=[a,b].join("/").split("/"):d=b.split("/");for(var f=0,g=d.length;f<g;f++)e=d[f],e==".."?c.pop():e!="."&&e!=""&&c.push(e);return c.join("/")},e=function(a){return a.split("/").slice(0,-1).join("/")};this.require=function(a){return c(a,"")},this.require.define=function(b){for(var c in b)a[c]=b[c]}}return this.require.define}).call(this)({"browser/browser-listener-client":function(a,b,c){},"browser/platform":function(a,b,c){var d={ajax:jQuery,pathSeparator:"/",getDocumentFromUrl:function(a,b){this.ajax.get(a,function(a){b(null,a)},"xml").error(function(a){b(a)})},parseDocumentFromString:function(a){return(new window.DOMParser).parseFromString(a,"application/xml")},getDocumentFromFilesystem:function(a,b){this.getDocumentFromUrl(a,b)},getResourceFromUrl:function(a,b){this.ajax.get(a,function(a){b(null,a)}).error(function(a){b(a)})},postDataToUrl:function(a,b,c){this.ajax.post(a,b,function(a){c(null,a)}).error(function(a){c(a)})},setTimeout:function(a,b){return window.setTimeout(a,b)},clearTimeout:function(a){window.clearTimeout(a)}};c.exports=d},"core/scxml/SCXML":function(a,b,c){function i(a){return function(a){var b=a[0],c=a[1];return b.source.depth<c.source.depth?c:c.source.depth<b.source.depth?b:b.documentOrder<c.documentOrder?b:c}}function k(a,b){this.model=a,this.opts=b,this.opts.log=this.opts.log||h.log,this.opts.StateIdSet=this.opts.StateIdSet||d,this.opts.EventSet=this.opts.EventSet||d,this.opts.TransitionPairSet=this.opts.TransitionPairSet||d,this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||i(this.opts.model),this._configuration=new this.opts.BasicStateSet,this._historyValue={},this._innerEventQueue=[],this._isInFinalState=!1,this._timeoutMap={},this._listeners=[]}function l(a,b){b=b||{},f(b),this._isStepping=!1,this._send=b.send||this._send,this._cancel=b.cancel||this._cancel,k.call(this,a,b)}var d=b("./set/ArraySet"),e=b("./state-kinds-enum"),f=b("./setup-default-opts"),g=b("./scxml-dynamic-name-match-transition-selector"),h=b("../../platform"),j=!1;k.prototype={start:function(){j&&h.log("performing initial big step"),this._configuration.add(this.model.root.initial);var a=this.model.actionFactory(this.opts.log,this._cancel.bind(this),this._send.bind(this),this.opts.origin,this.isIn.bind(this));return this._actions=a.actions,this._datamodel=a.datamodel,this._performBigStep(),this.getConfiguration()},_getOrSetData:function(a,b,c){var d=this._datamodel[b];if(!d)throw new Error("Variable "+b+" not declared in datamodel.");return d[a](c)},_getData:function(a){return this._getOrSetData("get",a)},_setData:function(a,b){return this._getOrSetData("set",a,b)},getConfiguration:function(){return this._configuration.iter().map(function(a){return a.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(a){return[a].concat(this.opts.model.getAncestors(a))},this).reduce(function(a,b){return a.concat(b)},[]).map(function(a){return a.id}).reduce(function(a,b){return a.indexOf(b)>-1?a:a.concat(b)},[])},isIn:function(a){return this.getFullConfiguration().indexOf(a)>-1},_performBigStep:function(a){a&&this._innerEventQueue.push(new this.opts.EventSet([a]));var b=!0;while(b){var c=this._innerEventQueue.length?this._innerEventQueue.shift():new this.opts.EventSet,d={},f=this._performSmallStep(c,d);b=!f.isEmpty()}this._isInFinalState=this._configuration.iter().every(function(a){return a.kind===e.FINAL})},_performSmallStep:function(a,b){j&&h.log("selecting transitions with eventSet: ",a);var c=this._selectTransitions(a,b);j&&h.log("selected transitions: ",c);if(!c.isEmpty()){j&&h.log("sorted transitions: ",c);var d=new this.opts.TransitionSet(c.iter().filter(function(a){return a.targets})),f=this._getStatesExited(d),g=f[0],i=f[1],k=this._getStatesEntered(d),l=k[0],m=k[1];j&&h.log("basicStatesExited ",g),j&&h.log("basicStatesEntered ",l),j&&h.log("statesExited ",i),j&&h.log("statesEntered ",m);var n=new this.opts.EventSet;j&&h.log("executing state exit actions"),i.forEach(function(c){j&&h.log("exiting ",c),this._listeners.forEach(function(a){a.onExit&&a.onExit(c.id)}),c.onexit!==undefined&&this._evaluateAction(c.onexit,a,b,n);var d;c.history&&(c.history.isDeep?d=function(a){return a.kind===e.BASIC&&c.descendants.indexOf(a)>-1}:d=function(a){return a.parent===c},this._historyValue[c.history.id]=i.filter(d))},this);var o=c.iter().sort(function(a,b){return a.documentOrder-b.documentOrder});j&&h.log("executing transitition actions"),o.forEach(function(c){var d=c.targets&&c.targets.map(function(a){return a.id});this._listeners.forEach(function(a){a.onTransition&&a.onTransition(c.source.id,d)}),c.actions!==undefined&&this._evaluateAction(c.actions,a,b,n)},this),j&&h.log("executing state enter actions"),m.forEach(function(c){this._listeners.forEach(function(a){a.onEntry&&a.onEntry(c.id)}),c.onentry!==undefined&&this._evaluateAction(c.onentry,a,b,n)},this),j&&h.log("updating configuration "),j&&h.log("old configuration ",this._configuration),this._configuration.difference(g),this._configuration.union(l),j&&h.log("new configuration ",this._configuration),n.isEmpty()||(j&&h.log("adding triggered events to inner queue ",n),this._innerEventQueue.push(n)),j&&h.log("updating datamodel for next small step :");for(var p in b)this._setData(p,b[p])}return c},_evaluateAction:function(a,b,c,d){function e(a){d.add({name:a,data:{}})}var f=this._getScriptingInterface(c,b,!0);return this._actions[a].call(this.opts.evaluationContext,f.getData,f.setData,f.events,e)},_getScriptingInterface:function(a,b,c){return{setData:c?function(b,c){return a[b]=c}:function(){},getData:this._getData.bind(this),events:b.iter()}},_getStatesExited:function(a){var b=new this.opts.StateSet,c=new this.opts.BasicStateSet;a.iter().forEach(function(a){var d=a.lca,e=d.descendants;this._configuration.iter().forEach(function(a){e.indexOf(a)>-1&&(c.add(a),b.add(a),this.opts.model.getAncestors(a,d).forEach(function(a){b.add(a)}))},this)},this);var d=b.iter().sort(function(a,b){return b.depth-a.depth});return[c,d]},_getStatesEntered:function(a){var b=new this.opts.StateSet,c=new this.opts.BasicStateSet,d=new this.opts.StateSet,f=[],g=function(a,c){h(c);var f=this.opts.model.getLCA(a,c);this.opts.model.getAncestors(c,f).forEach(function(a){a.kind===e.COMPOSITE?(b.add(a),d.add(a)):h(a)})}.bind(this),h=function(a){if(d.contains(a))return;a.kind===e.HISTORY?a.id in this._historyValue?this._historyValue[a.id].forEach(function(b){g(a,b)}):(b.add(a),c.add(a)):(b.add(a),a.kind===e.PARALLEL?f.push.apply(f,a.children.filter(function(a){return a.kind!==e.HISTORY})):a.kind===e.COMPOSITE?f.push(a.initial):(a.kind===e.INITIAL||a.kind===e.BASIC||a.kind===e.FINAL)&&c.add(a)),d.add(a)}.bind(this);a.iter().forEach(function(a){a.targets.forEach(function(b){g(a.source,b)})});var i;while(i=f.pop())h(i);var j=b.iter().sort(function(a,b){return a.depth-b.depth});return[c,j]},_selectTransitions:function(a,b){if(this.opts.onlySelectFromBasicStates)var c=this._configuration.iter();else{var d=new this.opts.StateSet;this._configuration.iter().forEach(function(a){d.add(a),this.opts.model.getAncestors(a).forEach(function(a){d.add(a)})},this),c=d.iter()}var e=this._getScriptingInterface(b,a),f=function(a){return this._actions[a.conditionActionRef].call(this.opts.evaluationContext,e.getData,e.setData,e.events)}.bind(this),i=a.iter().map(function(a){return a.name}),k=i.filter(function(a){return a.search(".")}).length,l=k?g:this.opts.transitionSelector,m=new this.opts.TransitionSet;c.forEach(function(a){l(a,i,f).forEach(function(a){m.add(a)})});var n=this._selectPriorityEnabledTransitions(m);return j&&h.log("priorityEnabledTransitions",n),n},_selectPriorityEnabledTransitions:function(a){var b=new this.opts.TransitionSet,c=this._getInconsistentTransitions(a),d=c[0],e=c[1];b.union(d),j&&h.log("enabledTransitions",a),j&&h.log("consistentTransitions",d),j&&h.log("inconsistentTransitionsPairs",e),j&&h.log("priorityEnabledTransitions",b);while(!e.isEmpty())a=new this.opts.TransitionSet(e.iter().map(function(a){return this.opts.priorityComparisonFn(a)},this)),c=this._getInconsistentTransitions(a),d=c[0],e=c[1],b.union(d),j&&h.log("enabledTransitions",a),j&&h.log("consistentTransitions",d),j&&h.log("inconsistentTransitionsPairs",e),j&&h.log("priorityEnabledTransitions",b);return b},_getInconsistentTransitions:function(a){var b=new this.opts.TransitionSet,c=new this.opts.TransitionPairSet,d=a.iter();j&&h.log("transitions",d);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++){var g=d[e],i=d[f];this._conflicts(g,i)&&(b.add(g),b.add(i),c.add([g,i]))}var k=a.difference(b);return[k,c]},_conflicts:function(a,b){return!this._isArenaOrthogonal(a,b)},_isArenaOrthogonal:function(a,b){var c=a.targets?a.lca:a.source,d=b.targets?b.lca:b.source,e=this.opts.model.isOrthogonalTo(c,d);return j&&(h.log("transition LCAs",c.id,d.id),h.log("transition LCAs are orthogonal?",e)),e},registerListener:function(a){return this._listeners.push(a)},unregisterListener:function(a){return this._listeners.splice(this._listeners.indexOf(a),1)}},l.prototype=Object.create(k.prototype),l.prototype.gen=function(a,b){var c;switch(typeof a){case"string":c={name:a,data:b};break;case"object":if(typeof a.name!="string")throw new Error('Event object must have "name" property of type string.');c=a;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("gen called before previous call to gen could complete. If executed in single-threaded environment, this means it was called recursively, which is illegal, as it would break SCION step semantics.");return this._isStepping=!0,this._performBigStep(c),this._isStepping=!1,this.getConfiguration()},l.prototype._send=function(a,b){var c,d,e=this;if(!h.setTimeout)throw new Error("setTimeout function not set");j&&h.log("sending event",a.name,"with content",a.data,"after delay",b.delay),c=function(){return e.gen(a)},d=h.setTimeout(c,b.delay);if(b.sendid)return this._timeoutMap[b.sendid]=d},l.prototype._cancel=function(a){if(!h.clearTimeout)throw new Error("clearTimeout function not set");if(a in this._timeoutMap)return j&&h.log("cancelling ",a," with timeout id ",this._timeoutMap[a]),h.clearTimeout(this._timeoutMap[a])},c.exports={SCXMLInterpreter:k,SimpleInterpreter:l}},"core/scxml/default-transition-selector":function(a,b,c){c.exports=function(a,b,c){return a.transitions.filter(function(a){return!a.event||b.indexOf(a.event)>-1&&(!a.cond||c(a))})}},"core/scxml/json2model":function(exports,require,module){function makeDatamodelDeclaration(a){var b="var ",c=[];for(var d in a){var e=a[d];c.push(e?d+" = "+e:d)}return c.length?b+c.join(", ")+";":""}function makeDatamodelClosures(a){var b=[];for(var c in a)b.push('"'+c+'" : {\n'+'"set" : function(v){ return '+c+" = v; },\n"+'"get" : function(){ return '+c+";}"+"\n}");return"{\n"+b.join(",\n")+"\n}"}function makeActionFactory(topLevelScripts,actionStrings,datamodel){var fnBody=makeDatamodelDeclaration(datamodel)+(topLevelScripts.length?topLevelScripts.join("\n"):"")+"return {\n"+"datamodel:"+makeDatamodelClosures(datamodel)+","+"actions:[\n"+actionStrings.join(",\n")+"\n]"+"\n};",fnStr="(function(){\nreturn function($log,$cancel,$send,$origin,In){\n"+fnBody+"\n};\n})()";return eval(fnStr)}module.exports=function(a){function b(a,b){return d.push("function(getData,setData,_events,$raise){var _event = _events[0];\n"+(b?"return":"")+" "+a+"\n}")-1}function c(a){return e[a]}var d=[],e={};return a.states.forEach(function(a){e[a.id]=a}),a.transitions.forEach(function(a){a.cond&&(a.conditionActionRef=b(a.cond,!0))}),a.states.forEach(function(d){d.transitions=d.transitions.map(function(b){return a.transitions[b]});var f=[];d.onentry&&(d.onentry=b(d.onentry)),d.onexit&&(d.onexit=b(d.onexit)),d.transitions.forEach(function(a){a.actions&&(a.actions=b(a.actions)),a.lca&&(a.lca=e[a.lca])}),d.initial=e[d.initial],d.history=e[d.history],d.children=d.children.map(c),d.parent=e[d.parent],d.ancestors&&(d.ancestors=d.ancestors.map(c)),d.descendants&&(d.descendants=d.descendants.map(c)),d.transitions.forEach(function(a){a.source=e[a.source],a.targets=a.targets&&a.targets.map(c)})}),a.root=e[a.root],a.actionFactory=makeActionFactory(a.scripts,d,a.datamodel),a}},"core/scxml/model":function(a,b,c){var d=b("./state-kinds-enum"),e={getAncestors:function(a,b){var c,d,e;return d=a.ancestors.indexOf(b),d>-1?a.ancestors.slice(0,d):a.ancestors},getAncestorsOrSelf:function(a,b){return[a].concat(this.getAncestors(a,b))},getDescendantsOrSelf:function(a){return[a].concat(a.descendants)},isOrthogonalTo:function(a,b){return!this.isAncestrallyRelatedTo(a,b)&&this.getLCA(a,b).kind===d.PARALLEL},isAncestrallyRelatedTo:function(a,b){return this.getAncestorsOrSelf(b).indexOf(a)>-1||this.getAncestorsOrSelf(a).indexOf(b)>-1},getLCA:function(a,b){var c=this.getAncestors(a).filter(function(a){return a.descendants.indexOf(b)>-1},this);return c[0]}};c.exports=e},"core/scxml/scxml-dynamic-name-match-transition-selector":function(a,b,c){function e(a){return new RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function f(a){return d[a]?d[a]:d[a]=e(a)}function g(a,b){var c=a.events,d=c.indexOf("*")>-1?function(){return!0}:function(a){return c.filter(function(b){return f(b).test(a)}).length};return b.filter(d).length}var d={};c.exports=function(a,b,c){return a.transitions.filter(function(a){return(!a.events||g(a,b))&&(!a.cond||c(a))})}},"core/scxml/set/ArraySet":function(a,b,c){function d(a){a=a||[],this.o=[],a.forEach(function(a){this.add(a)},this)}d.prototype={add:function(a){if(!this.contains(a))return this.o.push(a)},remove:function(a){var b=this.o.indexOf(a);return b===-1?!1:(this.o.splice(b,1),!0)},union:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.add(a)},this),this},difference:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.remove(a)},this),this},contains:function(a){return this.o.indexOf(a)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(a){var b=a.iter(),c=this.o;return c.every(function(a){return b.indexOf(a)>-1})&&b.every(function(a){return c.indexOf(a)>-1})},toString:function(){return"Set("+this.o.toString()+")"}},c.exports=d},"core/scxml/setup-default-opts":function(a,b,c){var d=b("./scxml-dynamic-name-match-transition-selector"),e=b("./set/ArraySet"),f=b("./model");c.exports=function(a){return a=a||{},a.TransitionSet=a.TransitionSet||e,a.StateSet=a.StateSet||e,a.BasicStateSet=a.BasicStateSet||e,a.transitionSelector=a.transitionSelector||d,a.model=a.model||f,a}},"core/scxml/state-kinds-enum":function(a,b,c){c.exports={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5}},"core/util/action-code-generator":function(a,b,c){function e(a){return a.map(f).join("\n;;\n")}function f(a){var b=d.deconstructNode(a),c=b[0],e=b[1],f=b[2],h=g[c];if(!h)throw new Error("Element "+c+" not yet supported");return h(e,f)}function h(a){return a?a.slice(-2)==="ms"?parseFloat(a.slice(0,-2)):a.slice(-1)==="s"?parseFloat(a.slice(0,-1))*1e3:parseFloat(a):0}function i(a,b){var c=a&&a.namelist&&a.namelist.trim().split(/ +/),e=b.filter(function(a){return a[0]==="param"}).map(function(a){return j(a)}),f=b.filter(function(a){return a[0]==="content"}).map(function(a){return d.deconstructNode(a)[2][0]})[0];if(f)return JSON.stringify(f);if(a.contentexpr)return a.contentexpr;var g="{";return c&&c.forEach(function(a){g+='"'+a+'"'+":"+a+",\n"}),e&&e.forEach(function(a){a.expr?g+='"'+a.name+'"'+":"+a.expr+",\n":a.location&&(g+='"'+a.name+'"'+":"+a.location+",\n")}),g+="}",g}function j(a){var b=d.deconstructNode(a),c=b[0],e=b[1],f=b[2];return{name:e.name,expr:e.expr,location:e.location}}var d=b("./jsonml"),g={script:function(a,b){return b.join("\n;;\n")},assign:function(a,b){return a.location+" = "+a.expr+";"},"if":function(a,b){var c="";c+="if("+a.cond+"){\n";for(var d=0;d<b.length;d++){var e=b[d];if(e[0]==="elseif"||e[0]==="else")break;Array.isArray(e)&&(c+=f(e)+"\n;;\n")}for(;d<b.length;d++){e=b[d];if(e[0]==="elseif")c+="}else if("+e[1].cond+"){\n";else{if(e[0]==="else"){c+="}";break}Array.isArray(e)&&(c+=f(e)+"\n;;\n")}}for(;d<b.length;d++)e=b[d],e[0]==="else"?c+="else{\n":Array.isArray(e)&&(c+=f(e)+"\n;;\n");return c+="}",c},elseif:function(){throw new Error("Encountered unexpected elseif tag.")},"else":function(){throw new Error("Encountered unexpected else tag.")},log:function(a,b){var c=[];return a.label&&c.push(JSON.stringify(a.label)),a.expr&&c.push(a.expr),"$log("+c.join(",")+");"},raise:function(a,b){return"$raise("+JSON.stringify(a.event)+");"},cancel:function(a,b){return"$cancel("+JSON.stringify(a.sendid)+");"},send:function(a,b){return"$send({\ntarget: "+(a.targetexpr?a.targetexpr:JSON.stringify(a.target))+",\n"+"name: "+(a.eventexpr?a.eventexpr:JSON.stringify(a.event))+",\n"+"type: "+(a.typeexpr?a.typeexpr:JSON.stringify(a.type))+",\n"+"data: "+i(a,b)+",\n"+"origin: $origin\n"+"}, {\n"+"delay: "+(a.delayexpr?a.delayexpr:h(a.delay))+",\n"+"sendId: "+(a.idlocation?a.idlocation:JSON.stringify(a.id))+"\n"+"});"},foreach:function(a,b){var c=a.index,d=a.index||"$i",e=a.item,g=a.array;return"(function(){\nfor("+(c?"":"var "+d+" = 0")+"; "+d+" < "+g+".length; "+d+"++){\n"+e+" = "+g+"["+d+"];\n"+b.filter(Array.isArray).map(f).join("\n;;\n")+"\n}\n"+"})();"}};c.exports={generateCode:e,codeGenerators:g}},"core/util/annotate-scxml-json":function(a,b,c){function r(a){var b=[];return a.forEach(function(a){var c=d.deconstructNode(a),e=c[0],f=c[1],g=c[2];e==="script"&&b.push.apply(b,g.filter(function(a){return typeof a=="string"}))}),b}function s(a){var b,c,d;c=0,d={};for(b in a)d[b]={name:b,documentOrder:c++};return d}function u(a,b){var c=d.deconstructNode(a,!0),f=c[0],g=c[1],h=c[2];if(g.event){var i;g.event==="*"?i=[g.event]:i=g.event.trim().split(/\s+/).map(function(a){var b=a.match(t);if(b){var c=b[1];if(!b||!c)throw new Error("Unable to parse event: "+a);return c}}),i.filter(function(a){return a!=="*"}).forEach(function(a){k[a]=!0});if(i.indexOf(undefined)>-1)throw new Error("Error parsing event attribute attributes.event")}var j={documentOrder:l.length,id:l.length,source:b.id,cond:g.cond,events:i,targets:g&&g.target&&g.target.trim().split(/\s+/)};return h.length&&(j.actions=e.generateCode(h)),l.push(j),j}function v(a,b){var c=d.deconstructNode(a,!0),e=c[0],f=c[1],g=c[2];g.filter(function(a){return a[0]==="data"}).forEach(function(a){var b=d.deconstructNode(a,!0),c=b[0],e=b[1],f=b[2];e.id&&(o[e.id]=e.expr||null)})}function w(a,b){var c=d.deconstructNode(a,!0),k=c[0],l=c[1],n=c[2],o=l&&l.id||z(k),p;switch(k){case"state":n.filter(function(a){return h.indexOf(a[0])>-1}).length?p=f.COMPOSITE:p=f.BASIC;break;case"scxml":p=f.COMPOSITE;break;case"initial":p=f.INITIAL;break;case"parallel":p=f.PARALLEL;break;case"final":p=f.FINAL;break;case"history":p=f.HISTORY;break;default:}var q={id:o,kind:p,descendants:[]};m[o]=q,b.length&&(q.parent=b[b.length-1]),p===f.HISTORY&&(q.isDeep=l.type==="deep"?!0:!1),q.documentOrder=i.length,i.push(q);if(p===f.BASIC||p===f.INITIAL||p===f.HISTORY)q.basicDocumentOrder=j.length,j.push(q);q.depth=b.length,q.ancestors=b.slice(),b.forEach(function(a){m[a].descendants.push(q.id)});var r,s,t=[],x=[],y=b.concat(q.id),A=!1,B=null,C=function(a){var b=w(a,y);return q.initial=b.id,x.push(b),A=!0};n.filter(function(a){return Array.isArray(a)}).forEach(function(a){var b=d.deconstructNode(a,!0),c=b[0],f=b[1],h=b[2];switch(c){case"transition":t.push(u(a,q));break;case"onentry":s=e.generateCode(h);break;case"onexit":r=e.generateCode(h);break;case"initial":if(!!A)throw new Error("Encountered duplicate initial states in state "+q.id);C(a);break;case"history":var i=w(a,y);q.history=i.id,x.push(i);break;case"datamodel":v(a,y);break;default:if(g.indexOf(c)>-1){var j=w(a,y);B===null&&(B=j),x.push(j)}}});if(!A&&k!=="parallel"){var D=l&&l.initial;function E(a){var b;return b=["initial",["transition",{target:a}]],C(b)}D?E(l.initial):B&&E(B.id)}return q.onexit=r,q.onentry=s,q.transitions=t.map(function(a){return a.documentOrder}),q.children=x.map(function(a){return a.id}),q}function z(a){return y[a]=y[a]||0,""+x+"-"+a+"-"+y[a]++}function A(a,b){var c,d,e,f,g,h,i;e=[],a.ancestors.forEach(function(a){d=m[a],d.descendants.indexOf(b.id)>-1&&e.push(a)});if(!e.length)throw new Error("Could not find LCA for states.");return e[0]}var d=b("./jsonml"),e=b("./action-code-generator"),f=b("../scxml/state-kinds-enum"),g=["state","parallel","history","final","initial"],h=g.concat("scxml"),i,j,k,l,m,n,o,p=a.transformAndSerialize=p=function(a){return JSON.stringify(q(a))},q=a.transform=function(a){i=[],j=[],k={},l=[],m={},n=[],o={};var b=w(a,[]),c=d.deconstructNode(a),e=c[0],f=c[1],g=c[2];return i.forEach(function(a){a.ancestors.reverse()}),i.forEach(function(a){a.descendants.reverse()}),l.filter(function(a){return a.targets}).forEach(function(a){var b=m[a.source],c=a.targets.map(function(a){return m[a]});if(!b)throw new Error("source missing");if(!c.length)throw new Error("target missing");a.lca=A(b,c[0])}),{states:i,transitions:l,root:b.id,events:s(k),scripts:r(g),profile:f.profile,version:f.version,datamodel:o}},t=/^((([^.]+)\.)*([^.]+))(\.\*)?$/,x="$generated",y={}},"core/util/docToModel":function(a,b,c){function i(a,b,c){var e=d.parseDOM(b),f=e[1];g&&g.getResourceFromUrl?k(a,f,function(a){a&&g.log("Errors downloading src attributes",a),j(f,c)}):j(f,c)}function j(a,b){try{var c=e.transform(a),d=f(c);b(null,d)}catch(g){b(g)}}function k(a,b,c){function f(){var b=d.pop();if(b){if(a)var h=a.split(g.pathSeparator).slice(0,-1).join(g.pathSeparator),i=h+g.pathSeparator+b[1].src;else i=b[1].src;g.getResourceFromUrl(i,function(a,c){a&&e.push(a),b.push(c),f()})}else c(e.length?e:null)}var d=[],e=[];l(b,d),f()}function l(a,b){var c=h.deconstructNode(a,!0),d=c[0],e=c[1],f=c[2];(d==="script"||d==="data")&&e&&e.src&&b.push(a),f.forEach(function(a){l(a,b)})}var d=b("../../external/jsonml/jsonml-dom"),e=b("./annotate-scxml-json"),f=b("../scxml/json2model"),g=b("../../platform"),h=b("./jsonml");c.exports=i},"core/util/inline-src-attribute":function(a,b,c){},"core/util/jsonml":function(a,b,c){c.exports={deconstructNode:function(a,b){var c,d,e,f,g;return g=a[0],f=a[1],f&&typeof f=="object"&&!Array.isArray(f)&&typeof f!="string"?(c=f,e=a.slice(2)):(c={},e=a.slice(1)),b&&(e=e.filter(function(a){return typeof a!="string"})),[g,c,e]}}},"external/jsonml/jsonml-dom":function(a,b,c){var d=d||{};(function(a){function b(a,b){return"item"in a?a.item(b):a[b]}function c(a){return a.localName||a.tagName}function d(a){return a?typeof a!="string"?String(a):a:""}"use strict",a.parseDOM=function(e,f){function g(c,d,e){if(c.hasChildNodes()){for(var f=0;f<c.childNodes.length;f++){var g=b(c.childNodes,f);g=a.parseDOM(g,d),g&&e.push(g)}return!0}return!1}if(!e||!e.nodeType)return e=null;var h,i;switch(e.nodeType){case 1:case 9:case 11:i=[d(c(e))];var j=e.attributes,k={},l=!1;for(h=0;j&&h<j.length;h++){var m=b(j,h);m.specified&&(m.name==="style"?k.style=e.style.cssText||m.value:k[m.name]=d(m.value),l=!0)}l&&i.push(k);var n;switch(i[0].toLowerCase()){case"frame":case"iframe":try{"undefined"!=typeof e.contentDocument?n=e.contentDocument:"undefined"!=typeof e.contentWindow?n=e.contentWindow.document:"undefined"!=typeof e.document&&(n=e.document),n=a.parseDOM(n,f),n&&i.push(n)}catch(o){}break;case"style":n=e.styleSheet&&e.styleSheet.cssText;if(n&&"string"==typeof n)n=n.replace("<!--","").replace("-->",""),i.push(n);else if(e.hasChildNodes())for(h=0;h<e.childNodes.length;h++)n=e.childNodes[h],n=a.parseDOM(n,f),n&&"string"==typeof n&&(n=n.replace("<!--","").replace("-->",""),i.push(n));break;case"input":g(e,f,i),n=e.type!=="password"&&e.value,n&&(l||(i.shift(),k={},i.unshift(k),i.unshift(e.tagName||"")),k.value=n);break;case"textarea":g(e,f,i)||(n=e.value||e.innerHTML,n&&"string"==typeof n&&i.push(n));break;default:g(e,f,i)}return"function"==typeof f&&(i=f(i,e)),e=null,i;case 3:case 4:var p=String(e.nodeValue);return e=null,p;case 10:i=["!"];var q=["DOCTYPE",(e.name||"html").toLowerCase()];return e.publicId&&q.push("PUBLIC",'"'+e.publicId+'"'),e.systemId&&q.push('"'+e.systemId+'"'),i.push(q.join(" ")),"function"==typeof f&&(i=f(i,e)),e=null,i;case 8:if((e.nodeValue||"").indexOf("DOCTYPE")!==0)return e=null,null;return i=["!",e.nodeValue],"function"==typeof f&&(i=f(i,e)),e=null,i;default:return e=null}},a.parseHTML=function(b,c){var d=document.createElement("div");d.innerHTML=b;var e=a.parseDOM(d,c);return d=null,e.length===2?e[1]:(e[0]="",e)}})(d),typeof c!==undefined&&c.exports&&(c.exports=d)},platform:function(a,b,c){function d(){return typeof Packages!="undefined"}function e(){return typeof process!="undefined"&&typeof c!="undefined"}function f(){return typeof window!="undefined"&&typeof document!="undefined"}d()?c.exports=b("./rhino/platform"):e()?c.exports=b("./node/platform"):f()?c.exports=b("./browser/platform"):c.exports=null},scion:function(a,b,c){var d=b("./platform"),e=b("./core/scxml/SCXML"),f=b("./core/util/docToModel");if(d){function g(a,b){d.getDocumentFromUrl(a,function(c,d){c?b(c):f(a,d,b)})}function h(a,b){d.getDocumentFromFilesystem(a,function(c,d){c?b(c):f(a,d,b)})}function i(a,b){f(null,d.parseDocumentFromString(a),b)}var j=c.exports={pathToModel:h,urlToModel:g,documentStringToModel:i,documentToModel:f,SCXML:e.SimpleInterpreter}}else c.exports={annotator:b("./core/util/annotate-scxml-json"),json2model:b("./core/scxml/json2model"),scxml:b("./core/scxml/SCXML")}}});